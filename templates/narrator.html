{% include "head.html.j2" %}
<body>
	<div class="container color-foreground">
		<div class="item row sticky">
			<a href="/">
				<div class="button" type="submit">
					<svg class="icon center" xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
						<path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z" />
					</svg>
				</div>
			</a>
			<h1 class="item row heading">Erz√§hler</h1>
			<a href="/narrator/settings">
				<div class="button settings">
					<i class="fa-solid fa-gear center"></i>
				</div>
			</a>
		</div>
		<div class="item row" style="height: 45px"></div>

		<div class="item row">
			<h2>Players:</h2>
			<ul></ul>
		</div>

		<div class="item row">
			<h2>Roles</h2>
			<p id="roleError" style="color: red"></p>
			<ul id="playerRoles"></ul>
		</div>

		<button class="item row" id="start-button">Start Game</button>
	</div>
</body>

<script type="text/javascript">
	document.getElementById('start-button').onclick = async function () {
		await fetch('/api/startgame')
			.then((r) => r.json())
			.then((data) => (gameData = data))
			.catch((e) => console.log('Something went wrong!'));

		console.log(gameData);

		if (gameData['status'] != 'success') {
			document.getElementById('roleError').innerHTML = gameData['data'];
			return;
		}

		list = document.getElementById('playerRoles');
		list.innerHTML = '';

		for (const [name, role] of Object.entries(gameData['data'])) {
			let li = document.createElement('li');
			li.innerText = `${name.charAt(0).toUpperCase() + name.slice(1)}: ${role}`;
			list.appendChild(li);
		}
	};
</script>

<script>
	// call api every 0.5 seconds to get the latest player list and update the page
	setInterval(getPlayers, 500);

	// maybe this can be put in a separate file? used in user.html as well
	async function getPlayers() {
		await fetch('/api/players')
			.then((r) => r.json())
			.then((data) => (players = data))
			.catch((e) => console.log('Something went wrong!'));

		console.log(players);
		let list = document.querySelector('ul');
		list.innerHTML = '';
		if (players.length > 0) {
			players.forEach((player) => {
				let li = document.createElement('li');
				li.innerText = player.charAt(0).toUpperCase() + player.slice(1);
				list.appendChild(li);
			});
			document.querySelector('h2').innerHTML = 'Players: ' + players.length;
		} else {
			let li = document.createElement('li');
			li.innerText = 'No players yet';
			list.appendChild(li);
			document.querySelector('h2').innerHTML = 'Players: 0';
		}
	}
</script>
